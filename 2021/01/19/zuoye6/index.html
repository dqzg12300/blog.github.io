<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>算法还原实战练习6 | king的博客</title><meta name="keywords" content="实战"><meta name="author" content="king"><meta name="copyright" content="king"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="分析样例下载：链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1Df_8OhozSEE17MIuIigvhg  密码: 4tgi 练习algorithmbase_60.apk 老样子ida打开libnative-lib.so找到encodeFromJni_160。然后看到了有个byte_2F050字符串加密处理了。unidbg跑一下解开看看字符串是什么  然后打开这个使用了加密字符串的函数">
<meta property="og:type" content="article">
<meta property="og:title" content="算法还原实战练习6">
<meta property="og:url" content="http://missking.cc/2021/01/19/zuoye6/index.html">
<meta property="og:site_name" content="king的博客">
<meta property="og:description" content="分析样例下载：链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1Df_8OhozSEE17MIuIigvhg  密码: 4tgi 练习algorithmbase_60.apk 老样子ida打开libnative-lib.so找到encodeFromJni_160。然后看到了有个byte_2F050字符串加密处理了。unidbg跑一下解开看看字符串是什么  然后打开这个使用了加密字符串的函数">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2021-01-19T21:46:49.000Z">
<meta property="article:modified_time" content="2022-09-05T12:58:31.530Z">
<meta property="article:author" content="king">
<meta property="article:tag" content="实战">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://missking.cc/2021/01/19/zuoye6/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '算法还原实战练习6',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-09-05 12:58:31'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/blogImg/litten.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">king的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">算法还原实战练习6</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-01-19T21:46:49.000Z" title="发表于 2021-01-19 21:46:49">2021-01-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-05T12:58:31.530Z" title="更新于 2022-09-05 12:58:31">2022-09-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="算法还原实战练习6"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>分析样例下载：链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1Df_8OhozSEE17MIuIigvhg">https://pan.baidu.com/s/1Df_8OhozSEE17MIuIigvhg</a>  密码: 4tgi</p>
<p>练习algorithmbase_60.apk</p>
<p>老样子ida打开libnative-lib.so找到encodeFromJni_160。然后看到了有个byte_2F050字符串加密处理了。unidbg跑一下解开看看字符串是什么</p>
<p><img src="/2021/01/19/zuoye6/image-20210119215422863.png" alt="image-20210119215422863"></p>
<p>然后打开这个使用了加密字符串的函数。发现里面是ollvm混淆过了的</p>
<p>这里我先静态分析一下。把每个函数打开大致的浏览下里面的内容。然后发现了两个比较特殊的函数sub_121DC和sub_C29C。这两个函数里面直接就有疑似算法部分的代码。特别是sub_C29C函数中直接看到了有base64的特征。</p>
<p><img src="/2021/01/19/zuoye6/image-20210119222948239.png" alt="image-20210119222948239"></p>
<p>接下来静态分析一下sub_121DC的参数。发现第一个参数应该是一个大小为258字节的数据。可能是用来加密的表。</p>
<a id="more"></a>

<p><img src="/2021/01/19/zuoye6/image-20210119224123191.png" alt="image-20210119224123191"></p>
<p>然后frida来hook一下。观察参数的意义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_native</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> base_addr=Module.getBaseAddress(<span class="string">&quot;libnative-lib.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> sub_121DC=base_addr.add(<span class="number">0x121DC</span>+<span class="number">1</span>);</span><br><span class="line">    Interceptor.attach(sub_121DC,&#123;</span><br><span class="line">        onEnter:<span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;onEnter sub_121DC&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.args2=args[<span class="number">2</span>]</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(args[<span class="number">0</span>],&#123;<span class="attr">length</span>:<span class="number">258</span>&#125;));</span><br><span class="line">            <span class="built_in">console</span>.log(args[<span class="number">1</span>].readCString());</span><br><span class="line">            <span class="built_in">this</span>.args3=args[<span class="number">3</span>];</span><br><span class="line">        &#125;,<span class="attr">onLeave</span>:<span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;onLeave sub_121DC&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(<span class="built_in">this</span>.args2,&#123;<span class="attr">length</span>:<span class="built_in">this</span>.args3.toInt32()&#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">var</span> sub_C29C=base_addr.add(<span class="number">0xC29C</span>+<span class="number">1</span>);</span><br><span class="line">    Interceptor.attach(sub_C29C,&#123;</span><br><span class="line">        onEnter:<span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;onEnter sub_C29C&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.arg0=args[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(args[<span class="number">1</span>],&#123;<span class="attr">length</span>:args[<span class="number">2</span>].toInt32()&#125;));</span><br><span class="line">            <span class="built_in">console</span>.log(args[<span class="number">2</span>]);</span><br><span class="line">        &#125;,<span class="attr">onLeave</span>:<span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;onLeave sub_C29C&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(retval);</span><br><span class="line">            <span class="built_in">console</span>.log(hexdump(<span class="built_in">this</span>.arg0,&#123;<span class="attr">length</span>:<span class="number">0x30</span>&#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据下面的输出结果。可以确定</p>
<p>sub_121DC参数1是258字节的表。参数2是输入参数。参数3是输出参数。参数4是长度</p>
<p>sub_C29C参数1是输出，也就是最后加密的结果。参数2是sub_121DC最后的输出结果（就是sub_121DC执行完后的参数2）。参数3是参数2的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> onEnter sub_121DC</span><br><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">ff87d218  ee a4 3d 85 31 ce 6b 76 90 67 d2 7e be 8f 6a b2  ..&#x3D;.1.kv.g.~..j.</span><br><span class="line">ff87d228  28 16 c5 c4 2e a8 1d 9d 2d 21 27 b0 11 15 fb 0b  (.......-!&#39;.....</span><br><span class="line">ff87d238  d6 26 36 79 1a 38 58 aa 47 44 49 c2 4d e1 05 18  .&amp;6y.8X.GDI.M...</span><br><span class="line">ff87d248  f4 2f 14 0c e9 cd 56 2c db 8d b3 d1 f9 60 eb df  .&#x2F;....V,.....&#96;..</span><br><span class="line">ff87d258  ab 9b b5 c7 0d d3 78 e3 45 99 63 01 5f c0 af 6c  ......x.E.c._..l</span><br><span class="line">ff87d268  3f 12 75 ac f0 e4 59 4e 84 37 9a 19 17 8a 7b 6e  ?.u...YN.7....&#123;n</span><br><span class="line">ff87d278  3b 68 cf 87 d5 f7 ef 8c dc 07 7a 7c 5d bc 72 c1  ;h........z|].r.</span><br><span class="line">ff87d288  0f d4 51 00 e8 2b 97 77 65 13 a1 04 94 1f a6 5b  ..Q..+.we......[</span><br><span class="line">ff87d298  82 98 b9 83 b6 b8 ca 91 4b 62 e0 f6 f2 c3 3e 2a  ........Kb....&gt;*</span><br><span class="line">ff87d2a8  e5 ec 40 96 f1 46 bf 6f 73 95 29 bb e6 ba 70 d7  ..@..F.os.)...p.</span><br><span class="line">ff87d2b8  5e 1b 7d 86 b7 c6 4c 55 5a 33 53 4a 25 cc d8 8b  ^.&#125;...LUZ3SJ%...</span><br><span class="line">ff87d2c8  dd 66 ad b4 c8 61 10 35 ea 89 93 1c a9 20 92 cb  .f...a.5..... ..</span><br><span class="line">ff87d2d8  8e 42 e7 d9 1e 54 a5 a2 c9 da f8 71 34 f3 57 88  .B...T.....q4.W.</span><br><span class="line">ff87d2e8  23 64 a3 a7 9f 48 6d fa 43 e2 de 30 ff ed 4f 03  #d...Hm.C..0..O.</span><br><span class="line">ff87d2f8  39 22 b1 fc 81 50 80 08 ae 09 5c 02 0e a0 06 bd  9&quot;...P....\.....</span><br><span class="line">ff87d308  24 52 f5 69 9c 7f 41 fe 3c 74 0a fd 3a d0 32 9e  $R.i..A.&lt;t..:.2.</span><br><span class="line">ff87d318  00 00                                            ..</span><br><span class="line">dtYeKUzFKTZnVLYSNZxSbrE</span><br><span class="line">onLeave sub_121DC</span><br><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">d6bd5e80  7d 1a b1 3b 1f 6b 7c 96 e9 e2 c1 a5 ea 3b e4 97  &#125;..;.k|......;..</span><br><span class="line">d6bd5e90  6d da 1e 01 75 92 e2                             m...u..</span><br><span class="line">onEnter sub_C29C</span><br><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">d6bd5e80  7d 1a b1 3b 1f 6b 7c 96 e9 e2 c1 a5 ea 3b e4 97  &#125;..;.k|......;..</span><br><span class="line">d6bd5e90  6d da 1e 01 75 92 e2                             m...u..</span><br><span class="line">0x17</span><br><span class="line">onLeave sub_C29C</span><br><span class="line">0x21</span><br><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">e53beac0  74 7c 75 3c 68 3c 78 61 74 65 42 74 4f 60 33 50  t|u&lt;h&lt;xateBtO&#96;3P</span><br><span class="line">e53bead0  51 20 4e 2f 47 79 6f 7a 49 42 32 4f 2f 75 5d 3d  Q N&#x2F;GyozIB2O&#x2F;u]&#x3D;</span><br><span class="line">e53beae0  00 00 76 69 74 79 3b 00 6e 63 65 00 29 00 01 00  ..vity;.nce.)...</span><br></pre></td></tr></table></figure>

<p>有了以上的一些记录。我们就可以锁定这两个就是关键加密函数了。接下来我们看看sub_121DC的结果是怎么计算出来的。这里由于是ollvm的。不方便静态分析。所以我直接用unidbg来模拟执行。并且trace这个函数的代码。看看是如何计算的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">lianxi60</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        lianxi60 lianxi = <span class="keyword">new</span> lianxi60();</span><br><span class="line">        lianxi.Call_EncodeFromJni_60();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> DvmClass Clazz;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">lianxi60</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        emulator = <span class="keyword">new</span> AndroidARMEmulator();</span><br><span class="line">        Memory memory = emulator.getMemory();</span><br><span class="line">        LibraryResolver resolver = <span class="keyword">new</span> AndroidResolver(<span class="number">23</span>);</span><br><span class="line">        memory.setLibraryResolver(resolver);</span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">null</span>);</span><br><span class="line">        vm.setVerbose(<span class="keyword">false</span>);</span><br><span class="line">        DalvikModule dm = vm.loadLibrary(<span class="keyword">new</span> File(<span class="string">&quot;unidbg-android/src/test/resources/example_binaries/lianxi60/libnative-lib.so&quot;</span>), <span class="keyword">false</span>);</span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line">        Clazz = vm.resolveClass(<span class="string">&quot;com/kanxue/algorithmbase/MainActivity&quot;</span>);</span><br><span class="line">        KingTrace trace=<span class="keyword">new</span> KingTrace(emulator);</span><br><span class="line">        <span class="keyword">long</span> start=<span class="number">0x400121DC</span>;     </span><br><span class="line">        <span class="keyword">long</span> end=<span class="number">0x40012326</span>;</span><br><span class="line">        trace.initialize(start,end,<span class="keyword">null</span>);</span><br><span class="line">        emulator.getBackend().hook_add_new(trace,start,end,emulator);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call_EncodeFromJni_60</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String res=Clazz.callStaticJniMethodObject(emulator,<span class="string">&quot;encodeFromJni_160(Ljava/lang/String;)Ljava/lang/String;&quot;</span>,<span class="string">&quot;dtYeKUzFKTZnVLYSNZxSbrE&quot;</span>).toString();</span><br><span class="line">        System.out.print(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行成功后。得到了完整的汇编执行的记录。然后我们分别搜索0x7d 0x1a 0xb1。发现结果都是在0x122a0这行计算出来的。然后我们直接搜索0x122a0。然后就看到了这个函数计算的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x64    r3&#x3D;0x19        &#x2F;&#x2F;r0&#x3D;0x7d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x10    r3&#x3D;0xa        &#x2F;&#x2F;r0&#x3D;0x1a&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x11    r3&#x3D;0xa0        &#x2F;&#x2F;r0&#x3D;0xb1&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x21    r3&#x3D;0x1a        &#x2F;&#x2F;r0&#x3D;0x3b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0xb    r3&#x3D;0x14        &#x2F;&#x2F;r0&#x3D;0x1f&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x41    r3&#x3D;0x2a        &#x2F;&#x2F;r0&#x3D;0x6b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x78    r3&#x3D;0x4        &#x2F;&#x2F;r0&#x3D;0x7c&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x6    r3&#x3D;0x90        &#x2F;&#x2F;r0&#x3D;0x96&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x49    r3&#x3D;0xa0        &#x2F;&#x2F;r0&#x3D;0xe9&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x40    r3&#x3D;0xa2        &#x2F;&#x2F;r0&#x3D;0xe2&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x40    r3&#x3D;0x81        &#x2F;&#x2F;r0&#x3D;0xc1&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x24    r3&#x3D;0x81        &#x2F;&#x2F;r0&#x3D;0xa5&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x42    r3&#x3D;0xa8        &#x2F;&#x2F;r0&#x3D;0xea&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x8    r3&#x3D;0x33        &#x2F;&#x2F;r0&#x3D;0x3b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x40    r3&#x3D;0xa4        &#x2F;&#x2F;r0&#x3D;0xe4&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x13    r3&#x3D;0x84        &#x2F;&#x2F;r0&#x3D;0x97&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x4c    r3&#x3D;0x21        &#x2F;&#x2F;r0&#x3D;0x6d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x5a    r3&#x3D;0x80        &#x2F;&#x2F;r0&#x3D;0xda&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x18    r3&#x3D;0x6        &#x2F;&#x2F;r0&#x3D;0x1e&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x1    r3&#x3D;0x0        &#x2F;&#x2F;r0&#x3D;0x1&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x60    r3&#x3D;0x15        &#x2F;&#x2F;r0&#x3D;0x75&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x12    r3&#x3D;0x80        &#x2F;&#x2F;r0&#x3D;0x92&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x122a0] [       18 43 ] 0x400122a0: orrs r0, r3-----r0&#x3D;0x40    r3&#x3D;0xa2        &#x2F;&#x2F;r0&#x3D;0xe2&quot;</span><br></pre></td></tr></table></figure>

<p>然后开始分析第一个7d的计算汇编。下面列出相关的日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xa4                        ;debug 0xbffff771[0]&#x3D;0xa4</span><br><span class="line">0x4001227c: ldrb r0, [r1, r0]-----r0&#x3D;0x1    r1&#x3D;0xbffff670    r0&#x3D;0x1        &#x2F;&#x2F;r0&#x3D;0xb7            ;debug 0xbffff670[0x1]&#x3D;0xb7</span><br><span class="line">0x40012284: ldrb r1, [r2, r1]-----r1&#x3D;0xa4    r2&#x3D;0xbffff670    r1&#x3D;0xa4        &#x2F;&#x2F;r1&#x3D;0xa4            ;debug 0xbffff670[0xa4]&#x3D;0xa4</span><br><span class="line">0x4001228a: add r0, r1-----r0&#x3D;0xb7    r1&#x3D;0xa4        &#x2F;&#x2F;r0&#x3D;0x15b                                                ;debug 0xb7+0xa4&#x3D;0x15b</span><br><span class="line">0x4001228e: uxtb r0, r0-----r0&#x3D;0x15b    r0&#x3D;0x15b        &#x2F;&#x2F;r0&#x3D;0x5b                                            ;debug 0x15b&amp;0xff&#x3D;0x5b</span><br><span class="line">0x4001228c: ldrb r2, [r3, r2]-----r2&#x3D;0x0    r3&#x3D;0x40212000    r2&#x3D;0x0        &#x2F;&#x2F;r2&#x3D;0x64            ;debug 0x40212000[0x0]&#x3D;0x64   input src</span><br><span class="line">0x40012292: ldrb r0, [r3, r0]-----r0&#x3D;0x5b    r3&#x3D;0xbffff670    r0&#x3D;0x5b        &#x2F;&#x2F;r0&#x3D;0x19            ;debug 0xbffff670[0x5b]&#x3D;0x19</span><br><span class="line">0x40012296: bic.w r3, r0, r2-----r3&#x3D;0xbffff670    r0&#x3D;0x19    r2&#x3D;0x64        &#x2F;&#x2F;r3&#x3D;0x19            ;debug 0x19 &amp;~ 0x64 &#x3D; 0x19</span><br><span class="line">0x4001229a: bic.w r0, r2, r0-----r0&#x3D;0x19    r2&#x3D;0x64    r0&#x3D;0x19        &#x2F;&#x2F;r0&#x3D;0x64                        ;debug 0x64 &amp;~ 0x19 &#x3D; 0x64</span><br><span class="line">0x400122a0: orrs r0, r3-----r0&#x3D;0x64    r3&#x3D;0x19        &#x2F;&#x2F;r0&#x3D;0x7d                                                    ;debug 0x64|0x19&#x3D;0x7d</span><br></pre></td></tr></table></figure>

<p>这里的重点就是ldrb取到的数据到底是什么数据。首先我们断点在0x121dd的位置。也就是函数的入口位置。</p>
<p><img src="/2021/01/19/zuoye6/image-20210123224352059.png" alt="image-20210123224352059"></p>
<p>然后看0xbffff670实际上就是函数的参数1。而0x40212000是函数的参数2。根据我们上面frida查到的。参数1就是258大小的一个字节数组。而参数2就是输入参数。因此我们可以根据trace的记录。来查一下和前面打印的字节数组是否对的上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">前面frida获取到的字节数组如下</span><br><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">ff87d218  ee a4 3d 85 31 ce 6b 76 90 67 d2 7e be 8f 6a b2  ..&#x3D;.1.kv.g.~..j.</span><br><span class="line">ff87d228  28 16 c5 c4 2e a8 1d 9d 2d 21 27 b0 11 15 fb 0b  (.......-!&#39;.....</span><br><span class="line">ff87d238  d6 26 36 79 1a 38 58 aa 47 44 49 c2 4d e1 05 18  .&amp;6y.8X.GDI.M...</span><br><span class="line">ff87d248  f4 2f 14 0c e9 cd 56 2c db 8d b3 d1 f9 60 eb df  .&#x2F;....V,.....&#96;..</span><br><span class="line">ff87d258  ab 9b b5 c7 0d d3 78 e3 45 99 63 01 5f c0 af 6c  ......x.E.c._..l</span><br><span class="line">ff87d268  3f 12 75 ac f0 e4 59 4e 84 37 9a 19 17 8a 7b 6e  ?.u...YN.7....&#123;n</span><br><span class="line">ff87d278  3b 68 cf 87 d5 f7 ef 8c dc 07 7a 7c 5d bc 72 c1  ;h........z|].r.</span><br><span class="line">ff87d288  0f d4 51 00 e8 2b 97 77 65 13 a1 04 94 1f a6 5b  ..Q..+.we......[</span><br><span class="line">ff87d298  82 98 b9 83 b6 b8 ca 91 4b 62 e0 f6 f2 c3 3e 2a  ........Kb....&gt;*</span><br><span class="line">ff87d2a8  e5 ec 40 96 f1 46 bf 6f 73 95 29 bb e6 ba 70 d7  ..@..F.os.)...p.</span><br><span class="line">ff87d2b8  5e 1b 7d 86 b7 c6 4c 55 5a 33 53 4a 25 cc d8 8b  ^.&#125;...LUZ3SJ%...</span><br><span class="line">ff87d2c8  dd 66 ad b4 c8 61 10 35 ea 89 93 1c a9 20 92 cb  .f...a.5..... ..</span><br><span class="line">ff87d2d8  8e 42 e7 d9 1e 54 a5 a2 c9 da f8 71 34 f3 57 88  .B...T.....q4.W.</span><br><span class="line">ff87d2e8  23 64 a3 a7 9f 48 6d fa 43 e2 de 30 ff ed 4f 03  #d...Hm.C..0..O.</span><br><span class="line">ff87d2f8  39 22 b1 fc 81 50 80 08 ae 09 5c 02 0e a0 06 bd  9&quot;...P....\.....</span><br><span class="line">ff87d308  24 52 f5 69 9c 7f 41 fe 3c 74 0a fd 3a d0 32 9e  $R.i..A.&lt;t..:.2.</span><br><span class="line">ff87d318  00 00                                            ..</span><br><span class="line"></span><br><span class="line">0x4001227c: ldrb r0, [r1, r0]-----r0&#x3D;0x1    r1&#x3D;0xbffff670    r0&#x3D;0x1        &#x2F;&#x2F;r0&#x3D;0xb7            ;debug 0xbffff670[0x1]&#x3D;0xb7</span><br><span class="line">0x40012284: ldrb r1, [r2, r1]-----r1&#x3D;0xa4    r2&#x3D;0xbffff670    r1&#x3D;0xa4        &#x2F;&#x2F;r1&#x3D;0xa4            ;debug 0xbffff670[0xa4]&#x3D;0xa4</span><br><span class="line">然后找上面数组对应的0x1和0xa4位置的数据</span><br><span class="line">0xbffff670[0x1]&#x3D;0xa4</span><br><span class="line">0xbffff670[0xa4]&#x3D;0xb7</span><br></pre></td></tr></table></figure>

<p>结果发现两个都对不上。但是按上面的逻辑来说。读取的确实是这个内存的数据。那么真相只有一个。那就是这段内存数据在函数开始时确实是这样的。但是执行到达这里进行计算前。将这段内存的数据进行了修改。所以和我们开始看到的内存数据不同了。然后为了拿到完整的被修改过的这个字节数据。我在函数最后结束的地方打一个断点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Debugger dbg= emulator.attach();</span><br><span class="line">dbg.addBreakPoint(<span class="number">0x40012326</span>);</span><br><span class="line">dbg.debug();</span><br></pre></td></tr></table></figure>

<p>然后输入m0xbffff670 258 将这块内存打印出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[libnative-lib.so] [0x12322] [ bd e8 00 0f ] 0x40012322: pop.w &#123;r8, sb, sl, fp&#125;-----r8&#x3D;0x3077af8a        &#x2F;&#x2F;r8&#x3D;0xfffe0a50</span><br><span class="line">debugger break at: 0x40012326</span><br><span class="line">&gt;&gt;&gt; r0&#x3D;0x713d41d5 r1&#x3D;0x55db7bae r2&#x3D;0xd822dfc5 r3&#x3D;0xfe9855a1 r4&#x3D;0xad19d0c2 r5&#x3D;0x55db7bae r6&#x3D;0x882e73ec r7&#x3D;0xbffff640 r8&#x3D;0xfffe0a50 sb&#x3D;0x40149ec0 sl&#x3D;0x0 fp&#x3D;0x0 ip&#x3D;0x20 SP&#x3D;0xbffff634 LR&#x3D;RX@0x40012277[libnative-lib.so]0x12277 PC&#x3D;RX@0x40012326[libnative-lib.so]0x12326 cpsr: N&#x3D;0, Z&#x3D;1, C&#x3D;1, V&#x3D;0, T&#x3D;1, mode&#x3D;0b10000</span><br><span class="line">&#x3D;&gt; *[libnative-lib.so]*[0x12327]*[*      f0 bd ]*0x40012326:*pop &#123;r4, r5, r6, r7, pc&#125;</span><br><span class="line">    [libnative-lib.so] [0x12329] [       a1 55 ] 0x40012328: strb r1, [r4, r6]</span><br><span class="line">    [libnative-lib.so] [0x1232b] [ 98 fe ec 73 ] 0x4001232a: cdp2 p3, #9, c7, c8, c12, #7</span><br><span class="line">    [libnative-lib.so] [0x1232f] [       2e 88 ] 0x4001232e: ldrh r6, [r5]</span><br><span class="line">    [libnative-lib.so] [0x12331] [       c2 d0 ] 0x40012330: beq #0x400122b8</span><br><span class="line">    [libnative-lib.so] [0x12333] [       19 ad ] 0x40012332: add r5, sp, #0x64</span><br><span class="line">    [libnative-lib.so] [0x12335] [       c5 df ] 0x40012334: svc #0xc5</span><br><span class="line">    [libnative-lib.so] [0x12337] [       22 d8 ] 0x40012336: bhi #0x4001237e</span><br><span class="line">    [libnative-lib.so] [0x12339] [       8a af ] 0x40012338: add r7, sp, #0x228</span><br><span class="line">    [libnative-lib.so] [0x1233b] [       77 30 ] 0x4001233a: adds r0, #0x77</span><br><span class="line">    [libnative-lib.so] [0x1233d] [       ba 25 ] 0x4001233c: movs r5, #0xba</span><br><span class="line">    [libnative-lib.so] [0x1233f] [       2a 62 ] 0x4001233e: str r2, [r5, #0x20]</span><br><span class="line">    [libnative-lib.so] [0x12341] [       5d 53 ] 0x40012340: strh r5, [r3, r5]</span><br><span class="line">    [libnative-lib.so] [0x12343] [       37 65 ] 0x40012342: str r7, [r6, #0x50]</span><br><span class="line">    [libnative-lib.so] [0x12345] [       d5 41 ] 0x40012344: rors r5, r2</span><br><span class="line">    [libnative-lib.so] [0x12347] [       3d 71 ] 0x40012346: strb r5, [r7, #4]</span><br><span class="line"></span><br><span class="line">m0xbffff670 258</span><br><span class="line"></span><br><span class="line">&gt;-----------------------------------------------------------------------------&lt;</span><br><span class="line">[23:05:14 396]unidbg@0xbffff670, md5&#x3D;44e110548f78d20dc6f2df3b306e45a3, hex&#x3D;eeb722ef6ff723786d60b22efbde0d1deb1521edc5b4b80b6cc3d1023af00136a0269d791a3858aa474449c24de10518f42f140ce9cd562cdb8db327f96728dfab9bb5c76ad376e3459963be5fc0af2d3f1275ac16e4594e84379a19178a7b6e3b68cf87d5ce858cdc077a7c5dbc72c10fd45100e82b97776513a104941fa65b8298b983b6d2ca914b62e0f6f27e3e2ae5ec4096f146bf31739529bbe6ba70d75e1b7d86a4c64c555a33534a25ccd88bdd66ada8c8611035ea89931ca92092cb8e42e7d91e54a5a2c9daf87134f357886b64a3a79f4890fa43e28f30ffc44f03393db1fc81508008ae095cb00ed606bd2452f5699c7f41fe3c740afd11d0329e20ed</span><br><span class="line">size: 258</span><br><span class="line">0000: EE B7 22 EF 6F F7 23 78 6D 60 B2 2E FB DE 0D 1D    ..&quot;.o.#xm&#96;......</span><br><span class="line">0010: EB 15 21 ED C5 B4 B8 0B 6C C3 D1 02 3A F0 01 36    ..!.....l...:..6</span><br><span class="line">0020: A0 26 9D 79 1A 38 58 AA 47 44 49 C2 4D E1 05 18    .&amp;.y.8X.GDI.M...</span><br><span class="line">0030: F4 2F 14 0C E9 CD 56 2C DB 8D B3 27 F9 67 28 DF    .&#x2F;....V,...&#39;.g(.</span><br><span class="line">0040: AB 9B B5 C7 6A D3 76 E3 45 99 63 BE 5F C0 AF 2D    ....j.v.E.c._..-</span><br><span class="line">0050: 3F 12 75 AC 16 E4 59 4E 84 37 9A 19 17 8A 7B 6E    ?.u...YN.7....&#123;n</span><br><span class="line">0060: 3B 68 CF 87 D5 CE 85 8C DC 07 7A 7C 5D BC 72 C1    ;h........z|].r.</span><br><span class="line">0070: 0F D4 51 00 E8 2B 97 77 65 13 A1 04 94 1F A6 5B    ..Q..+.we......[</span><br><span class="line">0080: 82 98 B9 83 B6 D2 CA 91 4B 62 E0 F6 F2 7E 3E 2A    ........Kb...~&gt;*</span><br><span class="line">0090: E5 EC 40 96 F1 46 BF 31 73 95 29 BB E6 BA 70 D7    ..@..F.1s.)...p.</span><br><span class="line">00A0: 5E 1B 7D 86 A4 C6 4C 55 5A 33 53 4A 25 CC D8 8B    ^.&#125;...LUZ3SJ%...</span><br><span class="line">00B0: DD 66 AD A8 C8 61 10 35 EA 89 93 1C A9 20 92 CB    .f...a.5..... ..</span><br><span class="line">00C0: 8E 42 E7 D9 1E 54 A5 A2 C9 DA F8 71 34 F3 57 88    .B...T.....q4.W.</span><br><span class="line">00D0: 6B 64 A3 A7 9F 48 90 FA 43 E2 8F 30 FF C4 4F 03    kd...H..C..0..O.</span><br><span class="line">00E0: 39 3D B1 FC 81 50 80 08 AE 09 5C B0 0E D6 06 BD    9&#x3D;...P....\.....</span><br><span class="line">00F0: 24 52 F5 69 9C 7F 41 FE 3C 74 0A FD 11 D0 32 9E    $R.i..A.&lt;t....2.</span><br><span class="line">0100: 20 ED                                               .</span><br><span class="line">^-----------------------------------------------------------------------------^</span><br></pre></td></tr></table></figure>

<p>这里我们再拿trace的记录对比。就发现能对的上了。现在这块内存就是算法计算时所使用的数据了。但是我们得搞清楚这个table是怎么计算变化的。先查看另外一个ldr的数据来源。然后看看他们之间是否有点什么关联</p>
<p>另一个内存0xbffff771。我们搜索一下使用到的位置是0x40012280。搜索一下这行的代码如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xa4&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xe1&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x66&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x97&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x65&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xd0&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x46&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xd6&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x3d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xf&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x8d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x4b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xda&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x44&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x16&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x3e&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x54&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x19&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xdd&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xb&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xb3&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x85&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x22&quot;</span><br></pre></td></tr></table></figure>

<p>然后发现这个数据每次都是从同一个位置读取的。这里我注意到了这个数据的长度似乎和input的长度一致。不知道input变动这里是否会改变。我们尝试输入两个32位的input来对比下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call_EncodeFromJni_60</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String res=Clazz.callStaticJniMethodObject(emulator,<span class="string">&quot;encodeFromJni_160(Ljava/lang/String;)Ljava/lang/String;&quot;</span>,<span class="string">&quot;1234567890abcdefghgklmnoqrstuvwx&quot;</span>).toString();</span><br><span class="line">        System.out.print(res);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>对应的0xbffff771数据如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xa4&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xe1&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x66&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x97&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x65&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xd0&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x46&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xd6&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x3d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xf&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x8d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x4b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xda&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x44&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x16&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x3e&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x54&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x19&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xdd&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xb&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xb3&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x85&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x22&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x4f&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x14&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x3b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xeb&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xfc&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x11&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xc&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x17&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xed&quot;</span><br></pre></td></tr></table></figure>

<p>然后再修改一下输入参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call_EncodeFromJni_60</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String res=Clazz.callStaticJniMethodObject(emulator,<span class="string">&quot;encodeFromJni_160(Ljava/lang/String;)Ljava/lang/String;&quot;</span>,<span class="string">&quot;9876543210gqrstuklmnovwxabfghcde&quot;</span>).toString();</span><br><span class="line">        System.out.print(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应内存的输出结果如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xa4&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xe1&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x66&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x97&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x65&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xd0&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x46&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xd6&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x3d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xf&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x8d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x4b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xda&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x44&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x16&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x3e&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x54&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x19&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xdd&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xb&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xb3&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x85&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x22&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x4f&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x14&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x3b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xeb&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xfc&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x11&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xc&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0x17&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x12280] [       09 78 ] 0x40012280: ldrb r1, [r1]-----r1&#x3D;0xbffff771    r1&#x3D;0xbffff771        &#x2F;&#x2F;r1&#x3D;0xed&quot;</span><br></pre></td></tr></table></figure>

<p>那么这里可以看出来这串数据也是固定的。那么这个数据是否和第一个参数有什么关联呢。我们下面贴上原始的258字节的参数1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0000: EE A4 3D 85 31 CE 6B 76 90 67 D2 7E BE 8F 6A B2    ..&#x3D;.1.kv.g.~..j.</span><br><span class="line">0010: 28 16 C5 C4 2E A8 1D 9D 2D 21 27 B0 11 15 FB 0B    (.......-!&#39;.....</span><br><span class="line">0020: D6 26 36 79 1A 38 58 AA 47 44 49 C2 4D E1 05 18    .&amp;6y.8X.GDI.M...</span><br><span class="line">0030: F4 2F 14 0C E9 CD 56 2C DB 8D B3 D1 F9 60 EB DF    .&#x2F;....V,.....&#96;..</span><br><span class="line">0040: AB 9B B5 C7 0D D3 78 E3 45 99 63 01 5F C0 AF 6C    ......x.E.c._..l</span><br><span class="line">0050: 3F 12 75 AC F0 E4 59 4E 84 37 9A 19 17 8A 7B 6E    ?.u...YN.7....&#123;n</span><br><span class="line">0060: 3B 68 CF 87 D5 F7 EF 8C DC 07 7A 7C 5D BC 72 C1    ;h........z|].r.</span><br><span class="line">0070: 0F D4 51 00 E8 2B 97 77 65 13 A1 04 94 1F A6 5B    ..Q..+.we......[</span><br><span class="line">0080: 82 98 B9 83 B6 B8 CA 91 4B 62 E0 F6 F2 C3 3E 2A    ........Kb....&gt;*</span><br><span class="line">0090: E5 EC 40 96 F1 46 BF 6F 73 95 29 BB E6 BA 70 D7    ..@..F.os.)...p.</span><br><span class="line">00A0: 5E 1B 7D 86 B7 C6 4C 55 5A 33 53 4A 25 CC D8 8B    ^.&#125;...LUZ3SJ%...</span><br><span class="line">00B0: DD 66 AD B4 C8 61 10 35 EA 89 93 1C A9 20 92 CB    .f...a.5..... ..</span><br><span class="line">00C0: 8E 42 E7 D9 1E 54 A5 A2 C9 DA F8 71 34 F3 57 88    .B...T.....q4.W.</span><br><span class="line">00D0: 23 64 A3 A7 9F 48 6D FA 43 E2 DE 30 FF ED 4F 03    #d...Hm.C..0..O.</span><br><span class="line">00E0: 39 22 B1 FC 81 50 80 08 AE 09 5C 02 0E A0 06 BD    9&quot;...P....\.....</span><br><span class="line">00F0: 24 52 F5 69 9C 7F 41 FE 3C 74 0A FD 3A D0 32 9E    $R.i..A.&lt;t..:.2.</span><br></pre></td></tr></table></figure>

<p>然后继续列出第二个固定的计算数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a4 e1 66 97 65 d0 46 d6 3d 0f 8d 4b da 44 16 3e 54 19 dd 0b b3 85 22 4f 14 3b eb fc 11 0c 17 ed</span><br></pre></td></tr></table></figure>

<p>接着我们列出trace里面每次从内存里面取到的两个数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xb7    r1&#x3D;0xa4        &#x2F;&#x2F;r0&#x3D;0x15b&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x22    r1&#x3D;0x3d        &#x2F;&#x2F;r0&#x3D;0x5f&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xef    r1&#x3D;0x85        &#x2F;&#x2F;r0&#x3D;0x174&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x6f    r1&#x3D;0x31        &#x2F;&#x2F;r0&#x3D;0xa0&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xf7    r1&#x3D;0xce        &#x2F;&#x2F;r0&#x3D;0x1c5&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x23    r1&#x3D;0x6b        &#x2F;&#x2F;r0&#x3D;0x8e&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x78    r1&#x3D;0x76        &#x2F;&#x2F;r0&#x3D;0xee&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x6d    r1&#x3D;0x90        &#x2F;&#x2F;r0&#x3D;0xfd&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x60    r1&#x3D;0x67        &#x2F;&#x2F;r0&#x3D;0xc7&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xb2    r1&#x3D;0xd2        &#x2F;&#x2F;r0&#x3D;0x184&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xc3    r1&#x3D;0x7e        &#x2F;&#x2F;r0&#x3D;0x141&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x1    r1&#x3D;0xbe        &#x2F;&#x2F;r0&#x3D;0xbf&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xde    r1&#x3D;0x8f        &#x2F;&#x2F;r0&#x3D;0x16d&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xd    r1&#x3D;0x6a        &#x2F;&#x2F;r0&#x3D;0x77&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x1d    r1&#x3D;0xd2        &#x2F;&#x2F;r0&#x3D;0xef&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xeb    r1&#x3D;0x28        &#x2F;&#x2F;r0&#x3D;0x113&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xf0    r1&#x3D;0x16        &#x2F;&#x2F;r0&#x3D;0x106&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x21    r1&#x3D;0xc5        &#x2F;&#x2F;r0&#x3D;0xe6&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xed    r1&#x3D;0xc4        &#x2F;&#x2F;r0&#x3D;0x1b1&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xc3    r1&#x3D;0x2e        &#x2F;&#x2F;r0&#x3D;0xf1&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xb4    r1&#x3D;0xa8        &#x2F;&#x2F;r0&#x3D;0x15c&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0xb8    r1&#x3D;0xd2        &#x2F;&#x2F;r0&#x3D;0x18a&quot;</span><br><span class="line">&quot;[libnative-lib.so] [0x1228a] [       08 44 ] 0x4001228a: add r0, r1-----r0&#x3D;0x36    r1&#x3D;0x9d        &#x2F;&#x2F;r0&#x3D;0xd3&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>似乎看起来没有什么关联。然后我们看下每次相加的两个值是否都在那个table里面。并且他们的索引是多少。我简单整理几个看一下有没什么关联</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data:0xb7 idx:0xa4        data:0xa4 idx:0x1</span><br><span class="line">data:0x22 idx:0xe1        data:0x3d idx:0x2</span><br><span class="line">data:0xef idx:0x66        data:0x85    idx:0x3</span><br><span class="line">data:0x6f idx:0x97        data:0x31 idx:0x4</span><br></pre></td></tr></table></figure>

<p>那这就相当巧了。因为我们在两个idx中都看到了熟悉的东西。第一个idx是我们那个固定字节数组。第二个idx直接就是索引。如此我们就知道了这个table是怎么变化的了。每次迭代进行计算的时候。先把固定key的数据和当前计算的下一个索引的值进行交换。然后以此类推。下面贴上py的还原代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re,struct</span><br><span class="line"></span><br><span class="line">tbkeyStr=<span class="string">&quot;&quot;&quot;ee a4 3d 85 31 ce 6b 76 90 67 d2 7e be 8f 6a b2 28 16 c5 c4 2e a8 1d 9d 2d 21 27 b0 11 15 fb 0b d6 26 36 79 1a 38 58 aa 47 44 49 c2 4d e1 05 18 f4 2f 14 0c e9 cd 56 2c db 8d b3 d1 f9 60 eb df ab 9b b5 c7 0d d3 78 e3 45 99 63 01 5f c0 af 6c 3f 12 75 ac f0 e4 59 4e 84 37 9a 19 17 8a 7b 6e 3b 68 cf 87 d5 f7 ef 8c dc 07 7a 7c 5d bc 72 c1 0f d4 51 00 e8 2b 97 77 65 13 a1 04 94 1f a6 5b 82 98 b9 83 b6 b8 ca 91 4b 62 e0 f6 f2 c3 3e 2a e5 ec 40 96 f1 46 bf 6f 73 95 29 bb e6 ba 70 d7 5e 1b 7d 86 b7 c6 4c 55 5a 33 53 4a 25 cc d8 8b dd 66 ad b4 c8 61 10 35 ea 89 93 1c a9 20 92 cb 8e 42 e7 d9 1e 54 a5 a2 c9 da f8 71 34 f3 57 88 23 64 a3 a7 9f 48 6d fa 43 e2 de 30 ff ed 4f 03 39 22 b1 fc 81 50 80 08 ae 09 5c 02 0e a0 06 bd 24 52 f5 69 9c 7f 41 fe 3c 74 0a fd 3a d0 32 9e&quot;&quot;&quot;</span></span><br><span class="line">tb2keyStr=<span class="string">&quot;&quot;&quot;a4 e1 66 97 65 d0 46 d6 3d 0f 8d 4b da 44 16 3e 54 19 dd 0b b3 85 22 4f 14 3b eb fc 11 0c 17 ed&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b2hex</span>(<span class="params">bins</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>.join([<span class="string">&quot;%02X&quot;</span> % x <span class="keyword">for</span> x <span class="keyword">in</span> bins]).strip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">StrToHexSplit</span>(<span class="params">str</span>):</span></span><br><span class="line">    buf = bytes(<span class="number">0</span>)</span><br><span class="line">    lines = re.split (<span class="string">r&#x27;[\r\n ]&#x27;</span>,str)</span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> len (code) &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        num = int (code,<span class="number">16</span>)</span><br><span class="line">        bnum = struct.pack (<span class="string">&#x27;B&#x27;</span>,num)</span><br><span class="line">        buf += bnum</span><br><span class="line">    <span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_data</span>(<span class="params">input</span>):</span></span><br><span class="line">    tbkey = bytearray(StrToHexSplit(tbkeyStr))</span><br><span class="line">    tb2key = bytearray(StrToHexSplit(tb2keyStr))</span><br><span class="line">    res=bytes(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(input)):</span><br><span class="line">        tb2value=tb2key[i]</span><br><span class="line">        tmp=tbkey[i+<span class="number">1</span>]</span><br><span class="line">        tbkey[i+<span class="number">1</span>]=tbkey[tb2key[i]]</span><br><span class="line">        tbkey[tb2key[i]]=tmp</span><br><span class="line">        tbvalue1 = tbkey[i + <span class="number">1</span>]</span><br><span class="line">        tbvalue2=tbkey[tb2value]</span><br><span class="line">        tbvalue=tbvalue1+tbvalue2</span><br><span class="line">        tbvalue=tbvalue&amp;<span class="number">0xff</span></span><br><span class="line">        chdata=ord(input[i])</span><br><span class="line">        tbres=tbkey[tbvalue]</span><br><span class="line">        cdata=(tbres&amp;~chdata)|(chdata&amp;~tbres)</span><br><span class="line">        res+=struct.pack(<span class="string">&quot;B&quot;</span>,cdata)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    res=calc_data(<span class="string">&quot;dtYeKUzFKTZnVLYSNZxSbrE&quot;</span>)</span><br><span class="line">    print(b2hex(res))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结算的结果如下。和我们之前frida抓到的第一个加密函数的结果对的上了。接下来就开始处理第二个加密函数。有点像base64的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7D 1A B1 3B 1F 6B 7C 96 E9 E2 C1 A5 EA 3B E4 97 6D DA 1E 01 75 92 E2</span><br></pre></td></tr></table></figure>

<p>我们再回头看看加密的明文和结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">input: TjHWtazVgwyqzLAuIoPtjuYvsyjCi output: t|u&lt;h&lt;xateBtO&#96;3PQ N&#x2F;GyozIB2O&#x2F;u]&#x3D;</span><br></pre></td></tr></table></figure>

<p>首先我们能够直接确定肯定不是标准的base64的结果。因为标准的是不会有那些特殊字符的。那么base64的table必然经过修改了。用ida打开看一下</p>
<p><img src="/2021/01/19/zuoye6/image-20210124192319165.png" alt="image-20210124192319165"></p>
<p>ida中显示的这个table也和结果不符。因为结果中有|和]这两个特殊字符。所以这个table必然是经过动态修改了的。那么我们用ida翻一下。看看是否有什么地方直接对这个数据进行修改的。</p>
<p><img src="/2021/01/19/zuoye6/image-20210124192746077.png" alt="image-20210124192746077"></p>
<p>找到修改的位置之后。然后我们需要查一下这里赋值的到底是什么。那么先看下汇编的表示</p>
<p><img src="/2021/01/19/zuoye6/image-20210124192907313.png" alt="image-20210124192907313"></p>
<p>我们需要hook到0xc1b4行。打印一下r0和r1的值是多少。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sub_C1B4=base_addr.add(<span class="number">0xC1B4</span>+<span class="number">1</span>);</span><br><span class="line">    Interceptor.attach(sub_C1B4,&#123;</span><br><span class="line">        onEnter:<span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.context.r0,<span class="built_in">this</span>.context.r1)</span><br><span class="line">        &#125;,<span class="attr">onLeave</span>:<span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>然后看到打印结果如下。r1固定是0x17。而这个0x17刚刚好是我们输入参数的长度。</p>
<p>r0转换成ascii码就是我们之前看到的AYZpq23IJrTFfghijklCDE1KLMmBdestU5678GHz0cuvwabN9+/VWXnoOPQRSxy4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">0x41 0x17</span><br><span class="line">0x59 0x17</span><br><span class="line">0x5a 0x17</span><br><span class="line">0x70 0x17</span><br><span class="line">0x71 0x17</span><br><span class="line">0x32 0x17</span><br><span class="line">0x33 0x17</span><br><span class="line">0x49 0x17</span><br><span class="line">0x4a 0x17</span><br><span class="line">0x72 0x17</span><br><span class="line">0x54 0x17</span><br><span class="line">0x46 0x17</span><br><span class="line">0x66 0x17</span><br><span class="line">0x67 0x17</span><br><span class="line">0x68 0x17</span><br><span class="line">0x69 0x17</span><br><span class="line">0x6a 0x17</span><br><span class="line">0x6b 0x17</span><br><span class="line">0x6c 0x17</span><br><span class="line">0x43 0x17</span><br><span class="line">0x44 0x17</span><br><span class="line">0x45 0x17</span><br><span class="line">0x31 0x17</span><br><span class="line">0x4b 0x17</span><br><span class="line">0x4c 0x17</span><br><span class="line">0x4d 0x17</span><br><span class="line">0x6d 0x17</span><br><span class="line">0x42 0x17</span><br><span class="line">0x64 0x17</span><br><span class="line">0x65 0x17</span><br><span class="line">0x73 0x17</span><br><span class="line">0x74 0x17</span><br><span class="line">0x55 0x17</span><br><span class="line">0x35 0x17</span><br><span class="line">0x36 0x17</span><br><span class="line">0x37 0x17</span><br><span class="line">0x38 0x17</span><br><span class="line">0x47 0x17</span><br><span class="line">0x48 0x17</span><br><span class="line">0x7a 0x17</span><br><span class="line">0x30 0x17</span><br><span class="line">0x63 0x17</span><br><span class="line">0x75 0x17</span><br><span class="line">0x76 0x17</span><br><span class="line">0x77 0x17</span><br><span class="line">0x61 0x17</span><br><span class="line">0x62 0x17</span><br><span class="line">0x4e 0x17</span><br><span class="line">0x39 0x17</span><br><span class="line">0x2b 0x17</span><br><span class="line">0x2f 0x17</span><br><span class="line">0x56 0x17</span><br><span class="line">0x57 0x17</span><br><span class="line">0x58 0x17</span><br><span class="line">0x6e 0x17</span><br><span class="line">0x6f 0x17</span><br><span class="line">0x4f 0x17</span><br><span class="line">0x50 0x17</span><br><span class="line">0x51 0x17</span><br><span class="line">0x52 0x17</span><br><span class="line">0x53 0x17</span><br><span class="line">0x78 0x17</span><br><span class="line">0x79 0x17</span><br><span class="line">0x34 0x17</span><br></pre></td></tr></table></figure>

<p>那么知道了这个table怎么变化之后。我们开始实现一下py的版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re,struct</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKey</span>(<span class="params">cnt</span>):</span></span><br><span class="line">    bkey = <span class="string">&quot;AYZpq23IJrTFfghijklCDE1KLMmBdestU5678GHz0cuvwabN9+/VWXnoOPQRSxy4&quot;</span></span><br><span class="line">    bkey_bytes=bytes(bkey,<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    res=bytearray()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(bkey)):</span><br><span class="line">        res.append((bkey_bytes[i] &amp;~ cnt)|(cnt &amp;~ bkey_bytes[i]))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base64Encode</span>(<span class="params">bkey,input</span>):</span></span><br><span class="line">    cnt=len(input)</span><br><span class="line">    cntpre=cnt<span class="number">-2</span></span><br><span class="line">    cnt1=cnt</span><br><span class="line">    output=bytes(<span class="number">0</span>)</span><br><span class="line">    input_bytes=input</span><br><span class="line">    v6=<span class="number">0</span></span><br><span class="line">    v7=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> v7 &gt;= cntpre:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        v9 = v7</span><br><span class="line">        v6 += <span class="number">4</span></span><br><span class="line">        output+=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[input_bytes[v7] &gt;&gt; <span class="number">2</span>])</span><br><span class="line">        v28_0 = (cnt &amp; ~v6) | (v6 &amp; ~ cnt)</span><br><span class="line">        output += struct.pack(<span class="string">&quot;B&quot;</span>, v28_0)</span><br><span class="line"></span><br><span class="line">        v10=input_bytes[v7+<span class="number">1</span>]</span><br><span class="line">        v11=input_bytes[v7]</span><br><span class="line">        v7+=<span class="number">3</span></span><br><span class="line">        output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[(v10 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xFFFFFFCF</span> | <span class="number">16</span> * (v11 &amp; <span class="number">3</span>)])</span><br><span class="line">        output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[((input_bytes[v9 + <span class="number">2</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0xFFFFFFC3</span>) | (<span class="number">4</span> * (input_bytes[v9 + <span class="number">1</span>] &amp; <span class="number">0xF</span>))])</span><br><span class="line">        output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[(input_bytes[v9 + <span class="number">2</span>])&amp;<span class="number">0x3f</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> v7 &lt; cnt1 :</span><br><span class="line">        output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[input_bytes[v7] &gt;&gt; <span class="number">2</span>])</span><br><span class="line">        v12 = <span class="number">16</span> * input_bytes[v7] &amp; <span class="number">0x30</span></span><br><span class="line">        <span class="keyword">if</span> cnt1 - <span class="number">1</span> == v7:</span><br><span class="line">            v13 = <span class="string">&#x27;=&#x27;</span></span><br><span class="line">            output+=bkey[v12]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output+=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[v12 | (input_bytes[v7+<span class="number">1</span>] &gt;&gt; <span class="number">4</span>)])</span><br><span class="line">            v13=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[<span class="number">4</span> * (input_bytes[v7+<span class="number">1</span>] &amp; <span class="number">0xF</span>)])</span><br><span class="line">        output+=bytes([<span class="number">0x3d</span>])</span><br><span class="line">        output+=v13</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">StrToHexSplit</span>(<span class="params">str</span>):</span></span><br><span class="line">    buf = bytes(<span class="number">0</span>)</span><br><span class="line">    lines = re.split (<span class="string">r&#x27;[\r\n ]&#x27;</span>,str)</span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> len (code) &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        num = int (code,<span class="number">16</span>)</span><br><span class="line">        bnum = struct.pack (<span class="string">&#x27;B&#x27;</span>,num)</span><br><span class="line">        buf += bnum</span><br><span class="line">    <span class="keyword">return</span> buf</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b2hex</span>(<span class="params">bins</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>.join([<span class="string">&quot;%02X&quot;</span> % x <span class="keyword">for</span> x <span class="keyword">in</span> bins]).strip()</span><br><span class="line"></span><br><span class="line">input=<span class="string">&quot;&quot;&quot;7D 1A B1 3B 1F 6B 7C 96 E9 E2 C1 A5 EA 3B E4 97 6D DA 1E 01 75 92 E2&quot;&quot;&quot;</span></span><br><span class="line">input_bytes=StrToHexSplit(input)</span><br><span class="line">bkey=getKey(len(input_bytes))</span><br><span class="line">print(<span class="string">&quot;bkey:&quot;</span>,b2hex(bkey))</span><br><span class="line">res=base64Encode(bkey,input_bytes)</span><br><span class="line">print(<span class="string">&quot;res:&quot;</span>,b2hex(res))</span><br></pre></td></tr></table></figure>

<p>然后py的输出结果是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bkey: 56 4E 4D 67 66 25 24 5E 5D 65 43 51 71 70 7F 7E 7D 7C 7B 54 53 52 26 5C 5B 5A 7A 55 73 72 64 63 42 22 21 20 2F 50 5F 6D 27 74 62 61 60 76 75 59 2E 3C 38 41 40 4F 79 78 58 47 46 45 44 6F 6E 23</span><br><span class="line">res: 63 13 7C 62 3C 7F 1F 3C 6F 61 63 1B 65 55 74 58 07 60 24 50 46 03 20 59 2F 50 0F 79 78 7A 5E 0B 42 25 4F 2F 75 3D 5D</span><br></pre></td></tr></table></figure>

<p>先验证一下key生成的是否正确。用frida取一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addr_key=base_addr.add(<span class="number">0x2F0B4</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hexdump(addr_key,&#123;<span class="attr">length</span>:<span class="number">64</span>&#125;))</span><br></pre></td></tr></table></figure>

<p>结果是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">d6c7a0b4  56 4e 4d 67 66 25 24 5e 5d 65 43 51 71 70 7f 7e  VNMgf%$^]eCQqp.~</span><br><span class="line">d6c7a0c4  7d 7c 7b 54 53 52 26 5c 5b 5a 7a 55 73 72 64 63  &#125;|&#123;TSR&amp;\[ZzUsrdc</span><br><span class="line">d6c7a0d4  42 22 21 20 2f 50 5f 6d 27 74 62 61 60 76 75 59  B&quot;! &#x2F;P_m&#39;tba&#96;vuY</span><br><span class="line">d6c7a0e4  2e 3c 38 41 40 4f 79 78 58 47 46 45 44 6f 6e 23  .&lt;8A@OyxXGFEDon#</span><br></pre></td></tr></table></figure>

<p>这里就知道key是计算正确的了。然后看看加密结果是否和之前对的上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#py计算的</span><br><span class="line">63 13 7C 62 3C 7F 1F 3C 6F 61 63 1B 65 55 74 58 07 60 24 50 46 03 20 59 2F 50 0F 79 78 7A 5E 0B 42 25 4F 2F 75 3D 5D</span><br><span class="line">#frida的结果转成16进制的</span><br><span class="line">t|u&lt;h&lt;xateBtO&#96;3PQ N&#x2F;GyozIB2O&#x2F;u]&#x3D;</span><br><span class="line">74 7C 75 3C 68 3C 78 61 74 65 42 74 4F 60 33 50 51 20 4E 2F 47 79 6F 7A 49 42 32 4F 2F 75 5D 3D</span><br></pre></td></tr></table></figure>

<p>明显和我们看到的结果不一致。说明可能不单单是table修改了。可能连base64算法都修改了。先找到之前看到的base64算法处。把关键的几行代码贴在下面</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">v6 = aAyzpq23ijrtffg[((v14 &gt;&gt; <span class="number">2</span>) ^ <span class="number">0x3FFFFFC0</span>) &amp; (v14 &gt;&gt; <span class="number">2</span>)];</span><br><span class="line">                                *v28 = a3 &amp; ~v6 | v6 &amp; ~(_BYTE)a3;</span><br><span class="line">                                v15 = v28 + <span class="number">2</span>;</span><br><span class="line">                                v28[<span class="number">1</span>] = aAyzpq23ijrtffg[(<span class="keyword">unsigned</span> __int8)((<span class="number">16</span> * *v13 ^ <span class="number">0xC0</span>) &amp; <span class="number">16</span> * *v13 | (*(_BYTE *)(a2 + v29 + <span class="number">1</span>) &gt;&gt; <span class="number">4</span>))];</span><br><span class="line">                                v16 = (_BYTE *)(v29 + <span class="number">2</span> + a2);</span><br><span class="line">                                v17 = (((~(<span class="number">4</span> * *(<span class="keyword">unsigned</span> __int8 *)(a2 + v29 + <span class="number">1</span>)) | <span class="number">0xFFFFFFC3</span>) &amp; <span class="number">0xFFFFFFF6</span>)</span><br><span class="line">                                     + (~(~(<span class="number">4</span> * *(<span class="keyword">unsigned</span> __int8 *)(a2 + v29 + <span class="number">1</span>)) | <span class="number">0xFFFFFFC3</span>) &amp; <span class="number">8</span>)) ^ ((((<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)*v16 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">1</span>) + (~((<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)*v16 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0xFFFFFFF6</span>)</span><br></pre></td></tr></table></figure>

<p>然后我们找个base64的标准的算法看一下是什么样子的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*v4 = aAbcdefghijklmn[v6 &gt;&gt; <span class="number">2</span>];</span><br><span class="line">      v4[<span class="number">1</span>] = aAbcdefghijklmn[<span class="number">16</span> * (<span class="keyword">unsigned</span> <span class="keyword">int</span>)*v5 &amp; <span class="number">0x30</span>LL | ((<span class="keyword">unsigned</span> __int64)v5[<span class="number">1</span>] &gt;&gt; <span class="number">4</span>)];</span><br><span class="line">      v4[<span class="number">2</span>] = aAbcdefghijklmn[<span class="number">4</span> * (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v5[<span class="number">1</span>] &amp; <span class="number">0x3C</span>LL | ((<span class="keyword">unsigned</span> __int64)v5[<span class="number">2</span>] &gt;&gt; <span class="number">6</span>)];</span><br><span class="line">      LOBYTE(v6) = aAbcdefghijklmn[v5[<span class="number">2</span>] &amp; <span class="number">0x3F</span>];</span><br></pre></td></tr></table></figure>

<p>然后再看看我们的py代码的关键计算处</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">output+=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[input_bytes[v7] &gt;&gt; <span class="number">2</span>])</span><br><span class="line">v10=input_bytes[v7+<span class="number">1</span>]</span><br><span class="line">v11=input_bytes[v7]</span><br><span class="line">v7+=<span class="number">3</span></span><br><span class="line">output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[(v10 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xFFFFFFCF</span> | <span class="number">16</span> * (v11 &amp; <span class="number">3</span>)])</span><br><span class="line">output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[((input_bytes[v9 + <span class="number">2</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0xFFFFFFC3</span>) | (<span class="number">4</span> * (input_bytes[v9 + <span class="number">1</span>] &amp; <span class="number">0xF</span>))])</span><br><span class="line">output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[(input_bytes[v9 + <span class="number">2</span>])&amp;<span class="number">0x3f</span>])</span><br></pre></td></tr></table></figure>

<p>那就看出来了。总共是有4个字节要赋值。那么根据这个特征。我们能看到那个v28就是主要用来存放4个字节计算的。那么我们先整理一下v28的赋值</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">v6 = aAyzpq23ijrtffg[((v14 &gt;&gt; <span class="number">2</span>) ^ <span class="number">0x3FFFFFC0</span>) &amp; (v14 &gt;&gt; <span class="number">2</span>)];</span><br><span class="line">*v28 = a3 &amp; ~v6 | v6 &amp; ~(_BYTE)a3;</span><br><span class="line">v28[<span class="number">1</span>] = aAyzpq23ijrtffg[(<span class="keyword">unsigned</span> __int8)((<span class="number">16</span> * *v13 ^ <span class="number">0xC0</span>) &amp; <span class="number">16</span> * *v13 | (*(_BYTE *)(a2 + v29 + <span class="number">1</span>) &gt;&gt; <span class="number">4</span>))];</span><br><span class="line">v15 = v28 + <span class="number">2</span>;</span><br><span class="line">v18 = v15 + <span class="number">1</span>;</span><br><span class="line">v17 = (((~(<span class="number">4</span> * *(<span class="keyword">unsigned</span> __int8 *)(a2 + v29 + <span class="number">1</span>)) | <span class="number">0xFFFFFFC3</span>) &amp; <span class="number">0xFFFFFFF6</span>)</span><br><span class="line">                                     + (~(~(<span class="number">4</span> * *(<span class="keyword">unsigned</span> __int8 *)(a2 + v29 + <span class="number">1</span>)) | <span class="number">0xFFFFFFC3</span>) &amp; <span class="number">8</span>)) ^ ((((<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)*v16 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">1</span>) + (~((<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)*v16 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0xFFFFFFF6</span>));</span><br><span class="line">*v15 = a3 &amp; ~aAyzpq23ijrtffg[v17] | aAyzpq23ijrtffg[v17] &amp; ~(_BYTE)a3;</span><br><span class="line">*v18 = aAyzpq23ijrtffg[v19];</span><br></pre></td></tr></table></figure>

<p>然后第一个字节我们对应的修改成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># output+=struct.pack(&quot;B&quot;,bkey[input_bytes[v7] &gt;&gt; 2])       第一个字节生成规则修改了                     </span></span><br><span class="line">v6 = bkey[((input_bytes[v7] &gt;&gt; <span class="number">2</span>) ^ <span class="number">0x3FFFFFC0</span>) &amp; (input_bytes[v7] &gt;&gt; <span class="number">2</span>)]                                              </span><br><span class="line">v28_0 = (cnt &amp; ~v6) | (v6 &amp; ~ cnt)                                                                                     </span><br><span class="line">output += struct.pack(<span class="string">&quot;B&quot;</span>, v28_0)                                                                                      </span><br><span class="line">                                                                                                                       </span><br><span class="line">v10=input_bytes[v7+<span class="number">1</span>]                                                                                                  </span><br><span class="line">v11=input_bytes[v7]                                                                                                    </span><br><span class="line">v7+=<span class="number">3</span>                                                                                                                  </span><br><span class="line"><span class="comment"># output +=struct.pack(&quot;B&quot;,bkey[(v10 &gt;&gt; 4) &amp; 0xFFFFFFCF | 16 * (v11 &amp; 3)])      第二个字节生成规则修改了</span></span><br><span class="line">output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[ ((<span class="number">16</span> * v11 ^ <span class="number">0xC0</span>) &amp; <span class="number">16</span> * v11 | (v10 &gt;&gt; <span class="number">4</span>))&amp;<span class="number">0xff</span>])                                      </span><br><span class="line"><span class="comment"># output +=struct.pack(&quot;B&quot;,bkey[((input_bytes[v9 + 2] &gt;&gt; 6) &amp; 0xFFFFFFC3) | (4 * (input_bytes[v9 + 1] &amp; 0xF))])  第三个规则也修改</span></span><br><span class="line">v17= ((input_bytes[v9 + <span class="number">2</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0xFFFFFFC3</span>) | (<span class="number">4</span> * (input_bytes[v9 + <span class="number">1</span>] &amp; <span class="number">0xF</span>))                                     </span><br><span class="line">output +=struct.pack(<span class="string">&quot;B&quot;</span>,(cnt &amp;~ bkey[v17])|(bkey[v17] &amp;~ cnt))                                                        </span><br><span class="line">output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[(input_bytes[v9 + <span class="number">2</span>])&amp;<span class="number">0x3f</span>])                                                             </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>依照c++的代码把每个计算部分都修改完成后。下面贴上完整的py代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re,struct</span><br><span class="line"></span><br><span class="line">tbkeyStr=<span class="string">&quot;&quot;&quot;ee a4 3d 85 31 ce 6b 76 90 67 d2 7e be 8f 6a b2 28 16 c5 c4 2e a8 1d 9d 2d 21 27 b0 11 15 fb 0b d6 26 36 79 1a 38 58 aa 47 44 49 c2 4d e1 05 18 f4 2f 14 0c e9 cd 56 2c db 8d b3 d1 f9 60 eb df ab 9b b5 c7 0d d3 78 e3 45 99 63 01 5f c0 af 6c 3f 12 75 ac f0 e4 59 4e 84 37 9a 19 17 8a 7b 6e 3b 68 cf 87 d5 f7 ef 8c dc 07 7a 7c 5d bc 72 c1 0f d4 51 00 e8 2b 97 77 65 13 a1 04 94 1f a6 5b 82 98 b9 83 b6 b8 ca 91 4b 62 e0 f6 f2 c3 3e 2a e5 ec 40 96 f1 46 bf 6f 73 95 29 bb e6 ba 70 d7 5e 1b 7d 86 b7 c6 4c 55 5a 33 53 4a 25 cc d8 8b dd 66 ad b4 c8 61 10 35 ea 89 93 1c a9 20 92 cb 8e 42 e7 d9 1e 54 a5 a2 c9 da f8 71 34 f3 57 88 23 64 a3 a7 9f 48 6d fa 43 e2 de 30 ff ed 4f 03 39 22 b1 fc 81 50 80 08 ae 09 5c 02 0e a0 06 bd 24 52 f5 69 9c 7f 41 fe 3c 74 0a fd 3a d0 32 9e&quot;&quot;&quot;</span></span><br><span class="line">tb2keyStr=<span class="string">&quot;&quot;&quot;a4 e1 66 97 65 d0 46 d6 3d 0f 8d 4b da 44 16 3e 54 19 dd 0b b3 85 22 4f 14 3b eb fc 11 0c 17 ed&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b2hex</span>(<span class="params">bins</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>.join([<span class="string">&quot;%02X&quot;</span> % x <span class="keyword">for</span> x <span class="keyword">in</span> bins]).strip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">StrToHexSplit</span>(<span class="params">str</span>):</span></span><br><span class="line">    buf = bytes(<span class="number">0</span>)</span><br><span class="line">    lines = re.split (<span class="string">r&#x27;[\r\n ]&#x27;</span>,str)</span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> len (code) &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        num = int (code,<span class="number">16</span>)</span><br><span class="line">        bnum = struct.pack (<span class="string">&#x27;B&#x27;</span>,num)</span><br><span class="line">        buf += bnum</span><br><span class="line">    <span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改key</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKey</span>(<span class="params">cnt</span>):</span></span><br><span class="line">    bkey = <span class="string">&quot;AYZpq23IJrTFfghijklCDE1KLMmBdestU5678GHz0cuvwabN9+/VWXnoOPQRSxy4&quot;</span></span><br><span class="line">    bkey_bytes=bytes(bkey,<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    res=bytearray()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(bkey)):</span><br><span class="line">        res.append((bkey_bytes[i] &amp;~ cnt)|(cnt &amp;~ bkey_bytes[i]))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改的base64算法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base64Encode</span>(<span class="params">bkey,input</span>):</span></span><br><span class="line">    cnt=len(input)</span><br><span class="line">    cntpre=cnt<span class="number">-2</span></span><br><span class="line">    cnt1=cnt</span><br><span class="line">    output=bytes(<span class="number">0</span>)</span><br><span class="line">    input_bytes=input</span><br><span class="line">    v6=<span class="number">0</span></span><br><span class="line">    v7=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> v7 &gt;= cntpre:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        v9 = v7</span><br><span class="line">        v6 += <span class="number">4</span></span><br><span class="line">        <span class="comment"># output+=struct.pack(&quot;B&quot;,bkey[input_bytes[v7] &gt;&gt; 2])</span></span><br><span class="line">        v6 = bkey[((input_bytes[v7] &gt;&gt; <span class="number">2</span>) ^ <span class="number">0x3FFFFFC0</span>) &amp; (input_bytes[v7] &gt;&gt; <span class="number">2</span>)]</span><br><span class="line">        v28_0 = (cnt &amp; ~v6) | (v6 &amp; ~ cnt)</span><br><span class="line">        output += struct.pack(<span class="string">&quot;B&quot;</span>, v28_0)</span><br><span class="line"></span><br><span class="line">        v10=input_bytes[v7+<span class="number">1</span>]</span><br><span class="line">        v11=input_bytes[v7]</span><br><span class="line">        v7+=<span class="number">3</span></span><br><span class="line">        <span class="comment"># output +=struct.pack(&quot;B&quot;,bkey[(v10 &gt;&gt; 4) &amp; 0xFFFFFFCF | 16 * (v11 &amp; 3)])</span></span><br><span class="line">        output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[ ((<span class="number">16</span> * v11 ^ <span class="number">0xC0</span>) &amp; <span class="number">16</span> * v11 | (v10 &gt;&gt; <span class="number">4</span>))&amp;<span class="number">0xff</span>])</span><br><span class="line">        <span class="comment"># output +=struct.pack(&quot;B&quot;,bkey[((input_bytes[v9 + 2] &gt;&gt; 6) &amp; 0xFFFFFFC3) | (4 * (input_bytes[v9 + 1] &amp; 0xF))])</span></span><br><span class="line">        v17= ((input_bytes[v9 + <span class="number">2</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0xFFFFFFC3</span>) | (<span class="number">4</span> * (input_bytes[v9 + <span class="number">1</span>] &amp; <span class="number">0xF</span>))</span><br><span class="line">        output +=struct.pack(<span class="string">&quot;B&quot;</span>,(cnt &amp;~ bkey[v17])|(bkey[v17] &amp;~ cnt))</span><br><span class="line">        output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[(input_bytes[v9 + <span class="number">2</span>])&amp;<span class="number">0x3f</span>])</span><br><span class="line">    <span class="keyword">if</span> v7 &lt; cnt1 :</span><br><span class="line">        output +=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[input_bytes[v7] &gt;&gt; <span class="number">2</span>])</span><br><span class="line">        v12 = <span class="number">16</span> * input_bytes[v7] &amp; <span class="number">0x30</span></span><br><span class="line">        <span class="keyword">if</span> cnt1 - <span class="number">1</span> == v7:</span><br><span class="line">            v13 = <span class="string">&#x27;=&#x27;</span></span><br><span class="line">            output+=bkey[v12]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output+=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[v12 | (input_bytes[v7+<span class="number">1</span>] &gt;&gt; <span class="number">4</span>)])</span><br><span class="line">            v13=struct.pack(<span class="string">&quot;B&quot;</span>,bkey[<span class="number">4</span> * (input_bytes[v7+<span class="number">1</span>] &amp; <span class="number">0xF</span>)])</span><br><span class="line">        output+=bytes([<span class="number">0x3d</span>])</span><br><span class="line">        output+=v13</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="comment">#加密算法1.把明文先加密一遍</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_data</span>(<span class="params">input</span>):</span></span><br><span class="line">    tbkey = bytearray(StrToHexSplit(tbkeyStr))</span><br><span class="line">    tb2key = bytearray(StrToHexSplit(tb2keyStr))</span><br><span class="line">    res=bytes(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(input)):</span><br><span class="line">        tb2value=tb2key[i]</span><br><span class="line">        tmp=tbkey[i+<span class="number">1</span>]</span><br><span class="line">        tbkey[i+<span class="number">1</span>]=tbkey[tb2key[i]]</span><br><span class="line">        tbkey[tb2key[i]]=tmp</span><br><span class="line">        tbvalue1 = tbkey[i + <span class="number">1</span>]</span><br><span class="line">        tbvalue2=tbkey[tb2value]</span><br><span class="line">        tbvalue=tbvalue1+tbvalue2</span><br><span class="line">        tbvalue=tbvalue&amp;<span class="number">0xff</span></span><br><span class="line">        chdata=ord(input[i])</span><br><span class="line">        tbres=tbkey[tbvalue]</span><br><span class="line">        cdata=(tbres&amp;~chdata)|(chdata&amp;~tbres)</span><br><span class="line">        res+=struct.pack(<span class="string">&quot;B&quot;</span>,cdata)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    res=calc_data(<span class="string">&quot;dtYeKUzFKTZnVLYSNZxSbrE&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;data:&quot;</span>,b2hex(res))</span><br><span class="line">    bkey = getKey(len(res))</span><br><span class="line">    print(<span class="string">&quot;bkey:&quot;</span>, b2hex(bkey))</span><br><span class="line">    res = base64Encode(bkey, res)</span><br><span class="line">    print(<span class="string">&quot;res:&quot;</span>, b2hex(res))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输出结果。对比上面frida抓到的完全一致。到这里做完了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data: 7D 1A B1 3B 1F 6B 7C 96 E9 E2 C1 A5 EA 3B E4 97 6D DA 1E 01 75 92 E2</span><br><span class="line">bkey: 56 4E 4D 67 66 25 24 5E 5D 65 43 51 71 70 7F 7E 7D 7C 7B 54 53 52 26 5C 5B 5A 7A 55 73 72 64 63 42 22 21 20 2F 50 5F 6D 27 74 62 61 60 76 75 59 2E 3C 38 41 40 4F 79 78 58 47 46 45 44 6F 6E 23</span><br><span class="line">res: 74 7C 75 3C 68 3C 78 61 74 65 42 74 4F 60 33 50 51 20 4E 2F 47 79 6F 7A 49 42 32 4F 2F 75 3D 5D</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">king</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://missking.cc/2021/01/19/zuoye6/">http://missking.cc/2021/01/19/zuoye6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://missking.cc" target="_blank">king的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%9E%E6%88%98/">实战</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/01/25/zuoye7/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">算法还原实战7</div></div></a></div><div class="next-post pull-right"><a href="/2021/01/14/zuoye5/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">算法还原实战练习5</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/01/05/zuoye1/" title="还原算法实战"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-05</div><div class="title">还原算法实战</div></div></a></div><div><a href="/2021/01/09/zuoye3/" title="算法还原实战练习3"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-09</div><div class="title">算法还原实战练习3</div></div></a></div><div><a href="/2021/01/07/zuoye2/" title="算法还原实战练习2"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-07</div><div class="title">算法还原实战练习2</div></div></a></div><div><a href="/2021/01/12/zuoye4/" title="算法还原实战练习4"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-12</div><div class="title">算法还原实战练习4</div></div></a></div><div><a href="/2021/01/14/zuoye5/" title="算法还原实战练习5"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-14</div><div class="title">算法还原实战练习5</div></div></a></div><div><a href="/2021/01/27/zuoye8/" title="算法还原实战8"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-27</div><div class="title">算法还原实战8</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assets/blogImg/litten.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">king</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dqzg12300"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/dqzg12300" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:king910827@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">新时代农民工</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/09/05/kernel1-0/" title="aosp12内核编译开启硬件断点和kprobes记录">aosp12内核编译开启硬件断点和kprobes记录</a><time datetime="2022-09-05T13:01:17.000Z" title="发表于 2022-09-05 13:01:17">2022-09-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/04/11/Kernel1/" title="linux内核书籍阅读笔记1">linux内核书籍阅读笔记1</a><time datetime="2022-04-11T22:38:34.000Z" title="发表于 2022-04-11 22:38:34">2022-04-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/20/CPU%E5%9F%BA%E7%A1%80/" title="逆向工程权威指南的看书笔记">逆向工程权威指南的看书笔记</a><time datetime="2022-03-20T15:38:13.000Z" title="发表于 2022-03-20 15:38:13">2022-03-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/01/27/MikRom/" title="FartExt超进化之奇奇怪怪的新ROM工具MikRom">FartExt超进化之奇奇怪怪的新ROM工具MikRom</a><time datetime="2022-01-27T13:48:38.000Z" title="发表于 2022-01-27 13:48:38">2022-01-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/07/26/fartext/" title="FartExt之优化更深主动调用的FART10">FartExt之优化更深主动调用的FART10</a><time datetime="2021-07-26T21:31:05.000Z" title="发表于 2021-07-26 21:31:05">2021-07-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By king</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'ihIPa0lRcHcfVzXqcboVznyu-gzGzoHsz',
      appKey: 'YB8y22BOhfzrVioINMUoEqxd',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://missking.cc/2021/01/19/zuoye6/'
    this.page.identifier = '2021/01/19/zuoye6/'
    this.page.title = '算法还原实战练习6'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>